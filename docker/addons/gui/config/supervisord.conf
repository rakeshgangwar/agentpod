; OpenCode Desktop - Supervisor Configuration
; Manages KasmVNC service only
; OpenCode and Code Server are started via entrypoint.sh
;
; KasmVNC includes its own X server, so we don't need Xvfb
; The xstartup script handles starting openbox and tint2

[supervisord]
nodaemon=false
logfile=/tmp/supervisord.log
pidfile=/tmp/supervisord.pid
childlogdir=/tmp

[program:kasmvnc]
; KasmVNC vncserver with integrated X server
; -select-de manual: use xstartup script instead of auto-detecting DE
; -disableBasicAuth: no password required (reverse proxy handles auth if needed)
; -geometry: set resolution from environment variables
command=/usr/bin/vncserver :%(ENV_DISPLAY_NUM)s -select-de manual -disableBasicAuth -geometry %(ENV_WIDTH)sx%(ENV_HEIGHT)s -websocketPort %(ENV_KASMVNC_PORT)s -interface 0.0.0.0 -fg
environment=HOME="/home/developer",USER="developer"
user=developer
autorestart=true
priority=100
stdout_logfile=/tmp/kasmvnc.log
stderr_logfile=/tmp/kasmvnc.err
; Give KasmVNC time to start up
startsecs=5
; Restart if it exits unexpectedly
exitcodes=0
