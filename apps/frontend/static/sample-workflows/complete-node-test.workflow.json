{
  "name": "Complete Node Test Workflow",
  "description": "Tests all functional nodes: triggers, logic, actions, AI, and code",
  "nodes": [
    {
      "id": "trigger-1",
      "type": "trigger",
      "position": { "x": 100, "y": 300 },
      "data": {
        "nodeType": "manual-trigger",
        "label": "Start Test",
        "triggerType": "manual",
        "inputData": {
          "testMode": true,
          "maxItems": 3
        }
      }
    },
    {
      "id": "http-1",
      "type": "action",
      "position": { "x": 350, "y": 300 },
      "data": {
        "nodeType": "http-request",
        "label": "Fetch Posts",
        "url": "https://jsonplaceholder.typicode.com/posts?_limit=3",
        "method": "GET",
        "headers": [],
        "responseType": "json",
        "timeout": 30000
      }
    },
    {
      "id": "condition-1",
      "type": "condition",
      "position": { "x": 600, "y": 300 },
      "data": {
        "nodeType": "condition",
        "label": "Has Posts?",
        "conditions": [
          {
            "field": "{{steps['http-1'].data.data.length}}",
            "operator": "greaterThan",
            "value": "0",
            "outputBranch": "true"
          }
        ],
        "defaultBranch": "false",
        "mode": "first"
      }
    },
    {
      "id": "js-1",
      "type": "action",
      "position": { "x": 850, "y": 200 },
      "data": {
        "nodeType": "javascript",
        "label": "Extract Titles",
        "code": "const posts = steps['http-1'].data.data;\nconst items = posts.map(post => ({\n  id: post.id,\n  title: post.title,\n  wordCount: post.body.split(' ').length\n}));\nreturn {\n  items,\n  totalPosts: items.length,\n  processedAt: new Date().toISOString()\n};",
        "inputs": {}
      }
    },
    {
      "id": "loop-1",
      "type": "action",
      "position": { "x": 1100, "y": 200 },
      "data": {
        "nodeType": "loop",
        "label": "Process Each Post",
        "itemsPath": "steps['js-1'].data.output.items",
        "batchSize": 1
      }
    },
    {
      "id": "ai-prompt-1",
      "type": "ai-agent",
      "position": { "x": 1350, "y": 200 },
      "data": {
        "nodeType": "ai-prompt",
        "label": "Categorize Post",
        "prompt": "Categorize this blog post title into one of these categories: technology, business, lifestyle, other.\n\nTitle: {{$item.title}}\n\nRespond with just the category name in lowercase.",
        "systemPrompt": "You are a content categorization assistant. Respond with only the category name.",
        "model": {
          "providerId": "anthropic",
          "modelId": "claude-sonnet-4-20250514"
        },
        "temperature": 0.3,
        "maxTokens": 50
      }
    },
    {
      "id": "switch-1",
      "type": "switch",
      "position": { "x": 1600, "y": 200 },
      "data": {
        "nodeType": "switch",
        "label": "Route by Category",
        "field": "{{steps['ai-prompt-1'].data.response}}",
        "cases": [
          { "value": "technology", "outputBranch": "tech" },
          { "value": "business", "outputBranch": "business" },
          { "value": "lifestyle", "outputBranch": "lifestyle" }
        ],
        "defaultCase": "other"
      }
    },
    {
      "id": "js-tech",
      "type": "action",
      "position": { "x": 1850, "y": 100 },
      "data": {
        "nodeType": "javascript",
        "label": "Tech Handler",
        "code": "return {\n  category: 'technology',\n  action: 'queue_for_tech_review',\n  item: steps['loop-1'].data.items[0]\n};",
        "inputs": {}
      }
    },
    {
      "id": "js-business",
      "type": "action",
      "position": { "x": 1850, "y": 200 },
      "data": {
        "nodeType": "javascript",
        "label": "Business Handler",
        "code": "return {\n  category: 'business',\n  action: 'send_to_analytics',\n  item: steps['loop-1'].data.items[0]\n};",
        "inputs": {}
      }
    },
    {
      "id": "js-other",
      "type": "action",
      "position": { "x": 1850, "y": 300 },
      "data": {
        "nodeType": "javascript",
        "label": "Other Handler",
        "code": "return {\n  category: 'other',\n  action: 'archive',\n  item: steps['loop-1'].data.items[0]\n};",
        "inputs": {}
      }
    },
    {
      "id": "merge-1",
      "type": "action",
      "position": { "x": 2100, "y": 200 },
      "data": {
        "nodeType": "merge",
        "label": "Collect Results",
        "mode": "wait",
        "inputCount": 3
      }
    },
    {
      "id": "js-summary",
      "type": "action",
      "position": { "x": 2350, "y": 200 },
      "data": {
        "nodeType": "javascript",
        "label": "Build Summary",
        "code": "const allResults = [\n  steps['js-tech']?.data?.output,\n  steps['js-business']?.data?.output,\n  steps['js-other']?.data?.output\n].filter(Boolean);\nconst summary = {\n  totalProcessed: allResults.length,\n  byCategory: {},\n  completedAt: new Date().toISOString()\n};\nallResults.forEach(r => {\n  summary.byCategory[r.category] = (summary.byCategory[r.category] || 0) + 1;\n});\nreturn summary;",
        "inputs": {}
      }
    },
    {
      "id": "ai-agent-1",
      "type": "ai-agent",
      "position": { "x": 2600, "y": 200 },
      "data": {
        "nodeType": "ai-agent",
        "label": "Generate Report",
        "prompt": "Based on this workflow execution summary, write a brief 2-sentence report:\n\n{{steps['js-summary'].data.output}}\n\nInclude the total items processed and category breakdown.",
        "model": {
          "providerId": "anthropic",
          "modelId": "claude-sonnet-4-20250514"
        },
        "timeout": "1 minute"
      }
    },
    {
      "id": "http-2",
      "type": "action",
      "position": { "x": 850, "y": 400 },
      "data": {
        "nodeType": "http-request",
        "label": "Log Failure",
        "url": "https://jsonplaceholder.typicode.com/posts",
        "method": "POST",
        "headers": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "type": "workflow_error",
          "message": "No posts found"
        },
        "responseType": "json",
        "timeout": 30000
      }
    }
  ],
  "edges": [
    { "id": "e1", "source": "trigger-1", "target": "http-1", "animated": true },
    { "id": "e2", "source": "http-1", "target": "condition-1", "animated": true },
    { "id": "e3", "source": "condition-1", "target": "js-1", "sourceHandle": "true", "animated": true },
    { "id": "e4", "source": "condition-1", "target": "http-2", "sourceHandle": "false", "animated": true },
    { "id": "e5", "source": "js-1", "target": "loop-1", "animated": true },
    { "id": "e6", "source": "loop-1", "target": "ai-prompt-1", "animated": true },
    { "id": "e7", "source": "ai-prompt-1", "target": "switch-1", "animated": true },
    { "id": "e8", "source": "switch-1", "target": "js-tech", "sourceHandle": "tech", "animated": true },
    { "id": "e9", "source": "switch-1", "target": "js-business", "sourceHandle": "business", "animated": true },
    { "id": "e10", "source": "switch-1", "target": "js-other", "sourceHandle": "lifestyle", "animated": true },
    { "id": "e10b", "source": "switch-1", "target": "js-other", "sourceHandle": "other", "animated": true },
    { "id": "e11", "source": "js-tech", "target": "merge-1", "animated": true },
    { "id": "e12", "source": "js-business", "target": "merge-1", "animated": true },
    { "id": "e13", "source": "js-other", "target": "merge-1", "animated": true },
    { "id": "e14", "source": "merge-1", "target": "js-summary", "animated": true },
    { "id": "e15", "source": "js-summary", "target": "ai-agent-1", "animated": true }
  ]
}
